import { describe, expect, test } from "@jest/globals";
import { DateTime } from "owlelia";
import { plusWorkdays, reverseOffsetWorkdays } from "./dates";

const d = DateTime.of;
// noinspection JSUnusedLocalSymbols
const holidays = [d("2023-01-01"), d("2023-01-04"), d("2023-03-01")];

describe("plusWorkdays", () => {
  describe.each<{
    date: string;
    days: number;
    expected: string;
  }>`
    date            | days  | expected
    ${"2022-12-29"} | ${1}  | ${"2022-12-30"}
    ${"2022-12-30"} | ${1}  | ${"2023-01-02"}
    ${"2022-12-31"} | ${1}  | ${"2023-01-02"}
    ${"2023-01-01"} | ${1}  | ${"2023-01-02"}
    ${"2023-01-02"} | ${1}  | ${"2023-01-03"}
    ${"2023-01-03"} | ${1}  | ${"2023-01-05"}
    ${"2023-01-04"} | ${1}  | ${"2023-01-05"}
    ${"2023-01-05"} | ${1}  | ${"2023-01-06"}
    ${"2023-01-06"} | ${1}  | ${"2023-01-09"}
    ${"2022-12-29"} | ${-1} | ${"2022-12-28"}
    ${"2022-12-30"} | ${-1} | ${"2022-12-29"}
    ${"2022-12-31"} | ${-1} | ${"2022-12-30"}
    ${"2023-01-01"} | ${-1} | ${"2022-12-30"}
    ${"2023-01-02"} | ${-1} | ${"2022-12-30"}
    ${"2023-01-03"} | ${-1} | ${"2023-01-02"}
    ${"2023-01-04"} | ${-1} | ${"2023-01-03"}
    ${"2023-01-05"} | ${-1} | ${"2023-01-03"}
    ${"2023-01-06"} | ${-1} | ${"2023-01-05"}
  `("plusWorkdays", ({ date, days, expected }) => {
    test(`date=${date}, days=${days}, expected=${expected}`, () => {
      expect(plusWorkdays(DateTime.of(date), days, holidays).displayDate).toBe(
        expected
      );
    });
  });
});

describe("reverseOffsetWorkdays", () => {
  describe.each<{
    date: string;
    days: number;
    expected: string[];
  }>`
    date            | days  | expected
    ${"2022-12-29"} | ${1}  | ${["2022-12-28"]}
    ${"2022-12-30"} | ${1}  | ${["2022-12-29"]}
    ${"2022-12-31"} | ${1}  | ${[]}
    ${"2023-01-01"} | ${1}  | ${[]}
    ${"2023-01-02"} | ${1}  | ${["2023-01-01", "2022-12-31", "2022-12-30"]}
    ${"2023-01-03"} | ${1}  | ${["2023-01-02"]}
    ${"2023-01-04"} | ${1}  | ${[]}
    ${"2023-01-05"} | ${1}  | ${["2023-01-04", "2023-01-03"]}
    ${"2023-01-06"} | ${1}  | ${["2023-01-05"]}
    ${"2022-12-29"} | ${-1} | ${["2022-12-30"]}
    ${"2022-12-30"} | ${-1} | ${["2022-12-31", "2023-01-01", "2023-01-02"]}
    ${"2022-12-31"} | ${-1} | ${[]}
    ${"2023-01-01"} | ${-1} | ${[]}
    ${"2023-01-02"} | ${-1} | ${["2023-01-03"]}
    ${"2023-01-03"} | ${-1} | ${["2023-01-04", "2023-01-05"]}
    ${"2023-01-04"} | ${-1} | ${[]}
    ${"2023-01-05"} | ${-1} | ${["2023-01-06"]}
    ${"2023-01-06"} | ${-1} | ${["2023-01-07", "2023-01-08", "2023-01-09"]}
    ${"2022-12-29"} | ${2}  | ${["2022-12-27"]}
    ${"2022-12-30"} | ${2}  | ${["2022-12-28"]}
    ${"2022-12-31"} | ${2}  | ${[]}
    ${"2023-01-01"} | ${2}  | ${[]}
    ${"2023-01-02"} | ${2}  | ${["2022-12-29"]}
    ${"2023-01-03"} | ${2}  | ${["2023-01-01", "2022-12-31", "2022-12-30"]}
    ${"2023-01-04"} | ${2}  | ${[]}
    ${"2023-01-05"} | ${2}  | ${["2023-01-02"]}
    ${"2023-01-06"} | ${2}  | ${["2023-01-04", "2023-01-03"]}
    ${"2022-12-29"} | ${-2} | ${["2022-12-31", "2023-01-01", "2023-01-02"]}
    ${"2022-12-30"} | ${-2} | ${["2023-01-03"]}
    ${"2022-12-31"} | ${-2} | ${[]}
    ${"2023-01-01"} | ${-2} | ${[]}
    ${"2023-01-02"} | ${-2} | ${["2023-01-04", "2023-01-05"]}
    ${"2023-01-03"} | ${-2} | ${["2023-01-06"]}
    ${"2023-01-04"} | ${-2} | ${[]}
    ${"2023-01-05"} | ${-2} | ${["2023-01-07", "2023-01-08", "2023-01-09"]}
    ${"2023-01-06"} | ${-2} | ${["2023-01-10"]}
  `("reverseOffsetWorkdays", ({ date, days, expected }) => {
    test(`date=${date}, days=${days}, expected=${expected}`, () => {
      expect(
        reverseOffsetWorkdays(DateTime.of(date), days, holidays).map(
          (d) => d.displayDate
        )
      ).toStrictEqual(expected);
    });
  });
});
